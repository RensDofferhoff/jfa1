---
title: "Report: Audit sample evaluation"
output: 
  html_document:
    theme: readable
---

```{r, include = FALSE}
colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf(
      "<span style='color: %s;'>%s</span>", color,
      x
    )
  } else {
    x
  }
}
```

```{css, echo=FALSE}
.math {
font-size: small;
}
#header {
background: rgb(34, 63, 135);
padding: 1em;
color: rgb(255, 255, 255);
}
```

---

<img src="jfaLogo.png" width="99.75" height="115.5" alt="logo" align="right" margin-left="20" margin-right="20"/>

This report was created by `r version$version.string` and its package **jfa** (version `r utils::packageVersion("jfa")`). **jfa** is free software and you can redistribute it and or modify it under the terms of the GNU GPL-3 as published by the Free Software Foundation. The package is distributed in the hope that it will be useful, but without any warranty; without even the implied warranty of merchantability of fitness for a particular purpose.

---

### Results

```{r echo=FALSE}
if (!is.null(object[["prior"]])) {
  inttype <- "Credible"
} else {
  inttype <- "Confidence"
}
df <- data.frame(n = object[["n"]])
if (!is.null(object[["N.units"]])) {
  df <- cbind(N = object[["N.units"]], df)
}
df$x <- object[["x"]]
df$t <- object[["t"]]
df$mle <- object[["mle"]]
df$int <- paste0("[", round(object[["lb"]], 3), "; ", round(object[["ub"]], 3), "]")
df$precision <- object[["precision"]]
if (object[["materiality"]] < 1) {
  if (!is.null(object[["prior"]])) {
    df$stat <- object[["posterior"]][["hypotheses"]]$bf.h1
  } else {
    df$stat <- object[["p.value"]]
  }
}
if (!is.null(object[["strata"]])) {
  rows <- data.frame(n = object[["strata"]][, "n"])
  if (!is.null(object[["N.units"]])) {
    rows <- cbind(rows, N = object[["strata"]][, "N"])
  }
  rows <- cbind(rows, object[["strata"]][, c("x", "t", "mle")])
  rows$int <- paste0("[", round(object[["strata"]]$lb, 3), "; ", round(object[["strata"]]$ub, 3), "]")
  rows$precision <- object[["strata"]][, "precision"]
  if (object[["materiality"]] < 1) {
    if (!is.null(object[["prior"]])) {
      rows$stat <- object[["strata"]][, "bf10"]
    } else {
      rows$stat <- object[["strata"]][["p.value"]]
    }
  }
  df <- rbind(df, rows)
  rownames(df) <- c("Population", rownames(object[["strata"]]))
} else {
  rownames(df) <- "Population"
}
if (object[["materiality"]] < 1) {
  if (!is.null(object[["prior"]])) {
    col_names <- c(
      "Sample size", "Misstatements", "Taint", "Most likely error",
      paste0(round(object[["conf.level"]] * 100, 2), "% ", inttype, " interval"), "Precision", "BF10"
    )
  } else {
    col_names <- c(
      "Sample size", "Misstatements", "Taint", "Most likely error",
      paste0(round(object[["conf.level"]] * 100, 2), "% ", inttype, " interval"), "Precision", "p-value"
    )
  }
} else {
  col_names <- c(
    "Sample size", "Misstatements", "Taint", "Most likely error",
    paste0(round(object[["conf.level"]] * 100, 2), "% ", inttype, " interval"), "Precision"
  )
}
if (!is.null(object[["N.units"]])) {
  col_names <- c("Total size", col_names)
}
colnames(df) <- col_names
tab <- knitr::kable(df,
  digits = 3, caption = "Table 1: Evaluation summary", format = "html",
  format.args = list(big.mark = ",", scientific = FALSE),
  table.attr = "style=''", align = "c"
)
if (object[["alternative"]] == "two.sided") {
  alternative_string <- paste0("The displayed ", tolower(inttype), " interval is two-sided.")
} else {
  alternative_string <- paste0("The displayed ", tolower(inttype), " interval is one-sided.")
}
if (object[["materiality"]] < 1) {
  test_string <- switch(object[["alternative"]],
    "two.sided" = paste0("For all tests, the alternative hypothesis specifies that misstatement \u2260 ", round(object[["materiality"]], 3), "."),
    "less" = paste0("For all tests, the alternative hypothesis specifies that misstatement < ", round(object[["materiality"]], 3), "."),
    "greater" = paste0("For all tests, the alternative hypothesis specifies that misstatement > ", round(object[["materiality"]], 3), ".")
  )
} else {
  test_string <- NULL
}
if (is.nan(object[["t"]])) {
  taint_string <- "The total taint could not be calculated because some book values are zero."
} else {
  taint_string <- NULL
}
tab <- kableExtra::footnote(tab,
  alphabet = c(alternative_string, test_string, taint_string),
  fixed_small_size = TRUE
)
kableExtra::kable_classic(tab, position = "center", html_font = "Cambria")
```

```{r echo=FALSE, fig.align='center'}
if (is.null(object[["strata"]])) {
  plot(0, object[["mle"]],
    pch = 19, ylim = c(0, 1), las = 1,
    ylab = "Misstatement", xlab = "", axes = FALSE
  )
  graphics::axis(side = 1, at = 0, labels = "Population")
  graphics::axis(side = 2, at = seq(0, 1, length.out = 5), las = 1)
  graphics::arrows(x0 = 0, x1 = 0, y0 = object[["lb"]], y1 = object[["ub"]], angle = 90, length = 0.05)
  graphics::arrows(x0 = 0, x1 = 0, y1 = object[["lb"]], y0 = object[["ub"]], angle = 90, length = 0.05)
} else {
  plot(0:nrow(object[["strata"]]), c(object[["mle"]], object[["strata"]]$mle),
    pch = 19, ylim = c(0, 1), las = 1,
    ylab = "Misstatement", xlab = "", axes = FALSE
  )
  graphics::axis(side = 1, at = 0:nrow(object[["strata"]]), labels = c("Population", rownames(object[["strata"]])), )
  graphics::axis(side = 2, at = seq(0, 1, length.out = 5), las = 1)
  graphics::arrows(x0 = 0:nrow(object[["strata"]]), x1 = 0:nrow(object[["strata"]]), y0 = c(object[["lb"]], object[["strata"]]$lb), y1 = c(object[["ub"]], object[["strata"]]$ub), angle = 90, length = 0.05)
  graphics::arrows(x0 = 0:nrow(object[["strata"]]), x1 = 0:nrow(object[["strata"]]), y1 = c(object[["lb"]], object[["strata"]]$lb), y0 = c(object[["ub"]], object[["strata"]]$ub), angle = 90, length = 0.05)
}
if (object[["materiality"]] < 1) {
  abline(h = object[["materiality"]], col = "darkred", lty = 2)
}
```

`r if (!is.null(object[["data"]])){ "### Data" }`

```{r, echo = FALSE}
if (!is.null(object[["data"]])) {
  tab <- knitr::kable(object[["data"]],
    digits = 3,
    caption = "Table 2: Sample data",
    align = "c",
    format = "html",
    row.names = FALSE,
    format.args = list(big.mark = ",", scientific = FALSE),
    table.attr = "style='width:70%;'"
  )
  kableExtra::kable_classic(tab, position = "center", html_font = "Cambria")
}
```

### Citation

```{r echo = FALSE}
citation("jfa")
```
